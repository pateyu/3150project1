.def temp = r16

ldi r17, 0b00000000
.def counter = r17

MOV r20, r17

RESET:
    ; Initialization code
    ldi temp, 0b11111111
    out DDRD, temp       ; Configure PD0 to PD7 as output
    out DDRE, temp       ; Configure PE as output

    out PORTD, temp      ; Set LEDs off initially
    out PORTE, temp
    cbi DDRA, 7
    sbi PORTA, 7

MAIN_LOOP:
    sbic PINA, 7
    rjmp MAIN_LOOP
    call delay           ; Debounce
    rjmp CHECK_COUNTER

CHECK_COUNTER:
    cpi counter, 0
    breq H_LIGHT
    call delay
    call delay
    call delay
    rjmp I_LIGHT

delay:
    LDI R19, 255

    LOOP2:
    LDI R21, 255

    LOOP3:
    NOP
    DEC R21
    BRNE LOOP3
    DEC R19
    BRNE LOOP2
    ret


H_LIGHT:
    ldi counter, 1       ; Update counter
    ldi r16, 0b01000010
    ldi r17, 0b11011111
    out PORTD, r16
    out PORTE, r17
    rjmp WAIT_FOR_RELEASE

I_LIGHT:
    ldi counter, 0       ; Reset counter
    ldi r16, 0b00011000
    ldi r17, 0b11001111  ; Turn on LED5 on PORTE (PE5)
    out PORTD, r16
    out PORTE, r17
    rjmp WAIT_FOR_RELEASE

WAIT_FOR_RELEASE:
    sbis PINA, 7
    rjmp WAIT_FOR_RELEASE
    rjmp MAIN_LOOP
